<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Management</title>
    <link rel="stylesheet" href="stylesheets/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
</head>

<body>
    <nav>
        <ul>
            <li><a class="active" href="/">LOGO</a></li>
            <li><a href="/events">Events</a></li>
            <li><a href="/branches" >Branches</a></li>
        </ul>
        <form class="search-form" action="/search" method="GET">
            <input type="text" name="q" placeholder="Search...">
            <button type="submit"><i class="fa fa-search"></i></button>
        </form>
        <ul>
            <li><a href="/login" class = button2>Login</a></li>
            <li><a href="/signup" class = button3>Signup</a></li>
        </ul>
    </nav>

    <button type = "button" id = "myBtn" class="accessibility-button">
        <i class="fas fa-eye"></i>
    </button>
    <!-- The Modal -->
    <div id="myModal" class="modal">
        <div class="modal-content">
          <span class="close">&times;</span>
          <div style="display: flex; align-items: center;">
            <h2 style="margin-right: 100px;">Dark Mode</h2>  <label class="switch">
              <input type="checkbox">
              <span class="slider round"></span>
            </label>
          </div>
        </div>
    </div>

    <div class="carousel">
        <h1>Management</h1>

        <iframe src="post-update.html" title="Post Update" width="100%" height="200" id="post-update-iframe"></iframe>
        <iframe src="create-event.html" title="Create Event" width="100%" height="200" id="create-event-iframe"></iframe>
    </div>



    <footer>
        <div class="footer-content">
            <div class="social-media-links">
                <a href="https://www.instagram.com" target="_blank"><i class="fab fa-instagram"></i></a>
                <a href="https://www.youtube.com" target="_blank"><i class="fab fa-youtube"></i></a>
                <a href="https://www.tiktok.com" target="_blank"><i class="fab fa-tiktok"></i></a>
            </div>
            <div class="footer-logo">
                <img src="images/logo.png" alt="Company Logo">
            </div>
            <div class="footer-links">
                <a href="/about">About Us</a>
                <a href="/contact">Contact Us</a>
            </div>
        </div>
    </footer>


    <button type="button" id="scrollToTopBtn" title="Go to top">â†‘ Top</button>

    <script src="javascripts/scrollbutton.js"></script>
    <script src="javascripts/homepage_slideshow.js"></script>
    <script src="javascripts/accessibilitybutton.js"></script>
    <script src="javascripts/highcontrast.js"></script>
    <script src="javascripts/vue.js"></script>
    <script src="javascripts/whoami.js"></script>

    <!-- can move all the script code to a new javascript when done -->
    <script>
        const postUpdateIframe = document.getElementById('post-update-iframe').contentWindow.document;

        async function fetchManagerOrganizations() {
            try {
                const response = await fetch('/updates/manager/organizations');
                const organizations = await response.json();

                const orgSelect = postUpdateIframe.getElementById('organization');
                organizations.forEach(org => {
                    const option = document.createElement('option');
                    option.value = org.id;
                    option.textContent = org.name;
                    orgSelect.appendChild(option);
                });
            } catch (error) {
                console.error('Error fetching organizations:', error);
            }
        }

        async function postUpdate(event) {
            event.preventDefault();

            const organizationId = postUpdateIframe.getElementById('organization').value;
            const title = postUpdateIframe.getElementById('title').value;
            const description = postUpdateIframe.getElementById('description').value;
            const is_private = postUpdateIframe.getElementById('is_private').checked;

            try {
                const response = await fetch(`/updates/organization/${organizationId}/updates`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ title, description, is_private })
                });

                const message = await response.text();
                postUpdateIframe.getElementById('responseMessage').textContent = message;

                if (response.status === 401) {
                    alert('You need to be logged in to post updates.');
                    window.location.href = '/login';
                    return;
                } else if (response.status === 403) {
                    alert('You do not have permission to post updates.');
                    return;
                }
            } catch (error) {
                console.error('Error posting update:', error);
            }
        }

        postUpdateIframe.getElementById('postUpdateForm').addEventListener('submit', postUpdate);
        postUpdateIframe.addEventListener('DOMContentLoaded', fetchManagerOrganizations);
    </script>
</body>



</html>