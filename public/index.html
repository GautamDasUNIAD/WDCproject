<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home</title>
    <link rel="stylesheet" href="stylesheets/base.css">
    <link rel="stylesheet" href="stylesheets/homepage.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

</head>

<body>
    <nav id="navbar">
        <div class="hamburger">
            <span></span>
            <span></span>
            <span></span>
        </div>
        <ul class="menu">
            <li><a class="active" href="/">LOGO</a></li>
            <li><a href="/events">Events</a></li>
            <li><a href="/branches">Branches</a></li>
        </ul>
        <div class="dropdown" id="organizations-dropdown-div">
            <div class="organizations-dropdown-button">Select an organization...</div>
            <div class="dropdown-content" id="organization-dropdown">
                <!-- Options will be populated dynamically -->
            </div>
        </div>
        <ul>
            <li><a href="/login" class="button2">Login</a></li>
            <li><a href="/signup" class="button3">Signup</a></li>
        </ul>
    </nav>


    <div class="carousel">
        <div class="slides">
            <div class="slide"><img src="/images/volunteering1.png" alt="Slide 1"></div>
            <div class="slide"><img src="/images/bg2.jpg" alt="Slide 2"></div>
            <div class="slide"><img src="/images/bg3.jpg" alt="Slide 3"></div>
        </div>
        <div class="carousel-overlay">
            <p class="carousel-text">Name here</p>
            <button type="button" id="joinBtn" class="join-btn" onclick="handleJoinClick()">Join Now</button>

        </div>
        <button type="button" class="prev">❮</button>
        <button type="button" class="next">❯</button>
    </div>



    <button type="button" id="myBtn" class="accessibility-button">
        <i class="fas fa-eye"></i>
    </button>
    <!-- The Modal -->
    <div id="myModal" class="modal" style="display:none">
        <div class="modal-content">
            <span class="close">&times;</span>
            <div style="display: flex; align-items: center;">
                <h2 style="margin-right: auto; position:relative;">Dark Mode</h2>
                <label style="position:relative; margin-right:auto;" class="switch">
                    <input type="checkbox">
                    <span class="slider round"></span>
                </label>
            </div>
        </div>
    </div>

    <div class="updates-section" id="updatessectionID">
        <h2>Daily Updates</h2>
        <!-- <div class="update">
            <img src="images/update.jpg" alt="Update 1">
            <div class="update-text">
                <h3>Date & Title</h3>
                <p>Description of the update...</p>
            </div>
        </div>
        <div class="update">
            <img src="images/update.jpg" alt="Update 2">
            <div class="update-text">
                <h3>Date & Title</h3>
                <p>Description of the update...</p>
            </div>
        </div> -->
        <!-- Add more updates as needed -->
    </div>
    <div class="button-container">
        <button type="button" id="readMoreButton" class="read-more-button">Read More</button>
    </div>
    <footer>
        <div class="footer-content">
            <div class="social-media-links">
                <a href="https://www.instagram.com" target="_blank"><i class="fab fa-instagram"></i></a>
                <a href="https://www.youtube.com" target="_blank"><i class="fab fa-youtube"></i></a>
                <a href="https://www.tiktok.com" target="_blank"><i class="fab fa-tiktok"></i></a>
            </div>
            <div class="footer-logo">
                <img src="images/logo.png" alt="Company Logo">
            </div>
            <div class="footer-links">
                <a href="/about">About Us</a>
                <a href="/contact">Contact Us</a>
            </div>
        </div>
    </footer>

    <button type="button" id="scrollToTopBtn" title="Go to top">↑ Top</button>

    <script src="javascripts/scrollbutton.js"></script>
    <script src="javascripts/homepage_slideshow.js"></script>
    <script src="javascripts/accessibilitybutton.js"></script>
    <script src="javascripts/highcontrast.js"></script>
    <script src="javascripts/whoami.js"></script>
    <script src="javascripts/adjustnav.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const hamburger = document.querySelector('.hamburger');
            const menus = document.querySelectorAll('.menu'); // Select all elements with class 'menu'

            hamburger.addEventListener('click', function () {
                hamburger.classList.toggle('active');

                // Toggle 'active' class for each menu element
                menus.forEach(menu => {
                    menu.classList.toggle('active');
                });
            });
        });

        document.addEventListener('DOMContentLoaded', async function () {
            var selectedOrgId = getCookie('selectedOrgId');
            const joinBtn = document.getElementById('joinBtn');
            const urlParams = new URLSearchParams(window.location.search);
            const eventList = document.getElementById('updatessectionID');
            const readMoreButton = document.getElementById('readMoreButton');
            const organizationId = selectedOrgId;
            let displayedUpdates = 4; // Number of initially displayed updates

            try {
                const selectedOrgId = getCookie('selectedOrgId');
                var name = getCookie('first_name');
                var isLoggedIn = name != undefined;
                let isMember = false;
                console.log("user is logged in: ", isLoggedIn);

                if (isLoggedIn && organizationId) {
                    var user_id = getCookie('id');
                    console.log("user id is: ", user_id);
                    const orgResponse = await fetch(`/userorganizations/isMember/${organizationId}`);
                    const orgUser = await orgResponse.json();
                    isMember = orgUser.isMember;
                }

                console.log("user is member", isMember);

                if (!isLoggedIn || !isMember) {
                    joinBtn.style.display = joinBtn.style.display;
                } else {
                    joinBtn.style.display = 'none';
                }
                const response = await fetch(`/updates/organization/${organizationId}/updates/public`);
                const publicUpdates = await response.json();

                const responseMember = await fetch(`/updates/organization/${organizationId}/updates/member`);
                const memberUpdates = responseMember.ok ? await responseMember.json() : [];

                const updates = [...publicUpdates, ...memberUpdates];

                updates.sort((a, b) => new Date(b.date) - new Date(a.date));

                function formatDate(isoDate) {
                    const date = new Date(isoDate);
                    const options = { year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit' };
                    return date.toLocaleDateString('en-US', options);
                };

                function displayUpdates(startIndex, endIndex) {
                    for (let i = startIndex; i < endIndex; i++) {
                        const update = updates[i];
                        const updateDiv = document.createElement('div');
                        updateDiv.classList.add('update-item');
                        const formattedDate = formatDate(update.date);

                        updateDiv.innerHTML = `
                            <div class="update">
                                <img src="images/update.jpg" alt="Update Image">
                                <div class="update-text">
                                    <h3>${update.title}</h3>
                                    <p>${update.description}</p>
                                    <p>Posted on: ${formattedDate}</p>
                                </div>
                            </div>
                        `;
                        eventList.appendChild(updateDiv);
                    }
                }


                displayUpdates(0, displayedUpdates);

                readMoreButton.addEventListener('click', function () {
                    const previousUpdatesCount = displayedUpdates;
                    displayedUpdates += 4; // Increase the number of displayed updates
                    displayUpdates(previousUpdatesCount, displayedUpdates);

                    // Hide the button if all updates are displayed
                    if (displayedUpdates >= updates.length) {
                        readMoreButton.style.display = 'none';
                    }
                });

                // Show "Read More" button if there are more updates to display
                if (updates.length > displayedUpdates) {
                    readMoreButton.style.display = 'block';
                } else {
                    readMoreButton.style.display = 'none';
                }
            } catch (error) {
                console.error('Error fetching updates:', error);
            }
        });

        async function handleJoinClick() {
            const selectedOrgId = getCookie('selectedOrgId');
            var name = getCookie('first_name');
            var isLoggedIn = name != undefined;
            console.log("user is logged in: ", isLoggedIn);
            if (!isLoggedIn) {
                window.location.href = '/login';
            } else {
                joinOrganization(selectedOrgId);
            }
        }

        async function joinOrganization(organizationId) {
            try {
                const response = await fetch('/userorganizations/join', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ organization_id: organizationId })
                });

                if (response.status === 401) {
                    document.getElementById('accessMessage').textContent = 'You need to be logged in to perform this action.';
                    return;
                }

                if (!response.ok) {
                    const errorText = await response.text();
                    document.getElementById('responseMessage').textContent = 'Error joining organization: ' + errorText;
                    return;
                }
                // alert('Successfully joined the organization');
                // showOrganizationActions(organizationId, document.getElementById('organizationName').textContent);
                window.location.href = "";
            } catch (error) {
                document.getElementById('responseMessage').textContent = 'An error occurred: ' + error.message;
            }
        }

    </script>




</body>

</html>