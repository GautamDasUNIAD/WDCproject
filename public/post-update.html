<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Post Update</title>
    <link rel="stylesheet" href="stylesheets/style.css">
</head>

<body>
    <nav>
        <ul>
            <li><a class="active" href="/home">LOGO</a></li>
            <li><a href="/events">Events</a></li>
            <li><a href="/branches">Branches</a></li>
        </ul>
        <ul>
            <li><a href="/login" class="button2">Login</a></li>
            <li><a href="/signup" class="button3">Signup</a></li>
        </ul>
    </nav>

    <div class="main-container">
        <div class="post-update-section">
            <h2>Post an Update</h2>
            <form id="postUpdateForm">
                <label for="title">Title:</label>
                <input type="text" id="title" name="title" required>

                <label for="content">Content:</label>
                <textarea id="content" name="content" required></textarea>

                <label for="isPublic">Public:</label>
                <input type="checkbox" id="isPublic" name="isPublic">

                <button type="submit">Post Update</button>
            </form>
            <div id="responseMessage"></div>
        </div>
    </div>

    <script>
        async function postUpdate(event) {
            event.preventDefault();

            const urlParams = new URLSearchParams(window.location.search);
            const organizationId = urlParams.get('organizationId');

            const title = document.getElementById('title').value;
            const content = document.getElementById('content').value;
            const isPublic = document.getElementById('isPublic').checked;

            try {
                const response = await fetch(`/updates/organization/${organizationId}/updates`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ title, content, isPublic })
                });

                const message = await response.text();
                document.getElementById('responseMessage').textContent = message;

                if (response.status === 401) {
                    alert('You need to be logged in to post updates.');
                    window.location.href = '/login';
                    return;
                } else if (response.status === 403) {
                    alert('You do not have permission to post updates.');
                    return;
                }
            } catch (error) {
                console.error('Error posting update:', error);
            }
        }

        document.getElementById('postUpdateForm').addEventListener('submit', postUpdate);
    </script>
</body>

</html>
